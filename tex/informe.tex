\documentclass[a4paper, 10pt, twoside]{article}

\usepackage[top=1in, bottom=1in, left=1in, right=1in]{geometry}
\usepackage[utf8]{inputenc}
\usepackage[spanish, es-ucroman, es-noquoting]{babel}
\usepackage{setspace}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{verbatim}
\usepackage{graphicx}
\usepackage{float}
\usepackage{enumitem} % Provee macro \setlist
\usepackage{tabularx}
\usepackage{multirow}
\usepackage{hyperref}
\usepackage{multicol}
\usepackage[toc, page]{appendix}


%%%%%%%%%% Configuración de Fancyhdr - Inicio %%%%%%%%%%
\pagestyle{fancy}
\thispagestyle{fancy}
\lhead{Trabajo Práctico 1 · Teoría de las Comunicaciones}
\rhead{Delgado · Lovisolo · Petaccio}
\renewcommand{\footrulewidth}{0.4pt}
\cfoot{\thepage /\pageref{LastPage}}

\fancypagestyle{caratula} {
   \fancyhf{}
   \cfoot{\thepage /\pageref{LastPage}}
   \renewcommand{\headrulewidth}{0pt}
   \renewcommand{\footrulewidth}{0pt}
}
%%%%%%%%%% Configuración de Fancyhdr - Fin %%%%%%%%%%


%%%%%%%%%% Miscelánea - Inicio %%%%%%%%%%
% Evita que el documento se estire verticalmente para ocupar el espacio vacío
% en cada página.
\raggedbottom

% Separación entre párrafos.
\setlength{\parskip}{0.5em}

% Separación entre elementos de listas.
\setlist{itemsep=0.5em}

% Asigna la traducción de la palabra 'Appendices'.
\renewcommand{\appendixtocname}{Apéndices}
\renewcommand{\appendixpagename}{Apéndices}
%%%%%%%%%% Miscelánea - Fin %%%%%%%%%%


%%%%%%%%%% Insertar grafo - Inicio %%%%%%%%%%
\newcommand{\grafo}[1]{
  \includegraphics[type=png,ext=.png,read=.png,width=16cm]{#1}
}
%%%%%%%%%% Insertar grafo - Fin %%%%%%%%%%


\begin{document}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Carátula                                                                  %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\thispagestyle{caratula}

\begin{center}

\includegraphics[height=2cm]{DC.png} 
\hfill
\includegraphics[height=2cm]{UBA.jpg} 

\vspace{2cm}

Departamento de Computación,\\
Facultad de Ciencias Exactas y Naturales,\\
Universidad de Buenos Aires

\vspace{4cm}

\begin{Huge}
Trabajo Práctico 1
\end{Huge}

\vspace{0.5cm}

\begin{Large}
Teoría de las Comunicaciones
\end{Large}

\vspace{1cm}

Primer Cuatrimestre de 2014

\vspace{4cm}

\begin{tabular}{|c|c|c|}
\hline
Apellido y Nombre & LU & E-mail\\
\hline
Delgado, Alejandro N.  & 601/11 & nahueldelgado@gmail.com\\
Lovisolo, Leandro      & 645/11 & leandro@leandro.me\\
Petaccio, Lautaro José & 443/11 & lausuper@gmail.com\\
\hline
\end{tabular}

\end{center}

\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Índice                                                                    %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\tableofcontents

\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Introducción                                                              %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Introducción téorica}
En este trabajo realizamos un análisis de redes mediante la captura de paquetes ARP.

Address Resolution Protocol (ARP) es un protocolo usado frecuentemente por las redes locales para conectar las capas 3 (capa de red) y 2 (capa de enlace) mediante la conversión o identificación de IP v4 con direcciones físicas MAC.

Existen dos tipos de paquetes posibles en el protocolo: paquetes de petición y de respuesta.
\begin{itemize}
	\item Los paquetes de petición (\texttt{who-has}) son enviados mayormente en forma de broadcast con el objetivo de poder localizar la dirección MAC a la cuál le pertenece una IP conocida.
	\item Los paquetes de respuesta (\texttt{is-at}) son enviados de manera uni-cast ya que se utilizan para responder a la máquina que realizó una petición con anterioridad.
\end{itemize}

La estructura de los paquetes ARP es simple, consiste principalmente de los siguientes campos:

\begin{description}
	\item[Operación] Especifica la operación que el emisor está realizando: 1 para petición, 2 para responder
	\item[Dirección MAC del emisor]
	\item[Dirección IP del emisior]
	\item[Dirección MAC del receptor] Este campo se ignora en las respuestas
	\item[Dirección IP del receptor]
\end{description}

A continuación se describe un ejemplo de uso típico observado en la práctica.

\begin{quotation}
	Una máquina en una red quiere mandarle un paquete de datos a otra máquina en la misma red. Para esto, la máquina emisora busca en su tabla local, la dirección MAC asociada a la dirección IP a la cuál quiere mandar el paquete. Si no la encuentra, realiza el broadcasts de la petición ARP, la cual llegará eventualmente, si se encuentra conectada, a la máquina destino. La máquina destino recibirá la petición y la responderá de manera uni-cast hacia la máquina que realizó la petición, poniendo en el paquete su dirección MAC para que la máquina destino de la respuesta pueda conocer la dirección MAC que necesitaba.
\end{quotation}

El análisis de la red consiste en reconocer su topología en base al nivel de información que proveen las diferentes IP, como fuente y como destino, tomando a las IP como símbolos y estimado su probabilidad de aparición con su frecuencia muestral.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Desarrollo                                                                %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Desarrollo}

Implementamos, para nuestro análisis, un \textit{sniffer}\footnote{\texttt{arpsniffer.py}} o monitor de paquetes, con el objetivo de poder analizar los paquetes ARP siendo enviados vía broadcast por el medio utilizado. Esta implementación se realizó en Python y utiliza la biblioteca Scapy \footnote{\url{http://www.secdev.org/projects/scapy}} para la captura de paquetes, provista por la cátedra.

Los medios utilizados para la captura de paquetes fueron tres redes Wi-Fi, de acceso público y de frecuente utilización.

Identificamos las redes según su SSID:
\begin{itemize}
	\item Alto Palermo
	\item McDonald's
	\item Starbucks
\end{itemize}

La captura de paquetes ARP consistió en el monitoreo de los paquetes ARP durante media hora aproximadamente para cada red Wi-Fi. Se almacenaron los campos principales de cada paquete para luego realizar el análisis estadístico.

Habiendo obtenido las capturas de las redes, nos proponemos identificar el o los routers de la red que actúan como \textit{gateway} de las redes analizadas. Para esto, calculamos dos tipos de frecuencia muestral para cada IP, la primera en relación a cuántos paquetes \texttt{who-has} la tienen como emisor y la segunda, cuántos paquetes \texttt{who-has} la tienen como destino. De este análisis, conseguimos la frecuencia muestral de cada IP como emisor y como destino.

Consideramos como fuente de información a $S_{src}$ y $S_{dst}$ que tomamos como las creadoras de paquetes emisores de ARP y receptores de ARP respectivamente. Para cada fuente, calculamos la información de cada IP (símbolos de la fuente) y realizamos la identificación del o de los routers en la red según este parámetro, que según proponemos, las IP asociadas a éstos deberían poseer la menor cantidad de información debido a que su frecuencia de recepción e incluso emisión de paquetes ARP debería ser la más alta. Nuestra suposición sobre esto, se basa en que el router será el dispositivo a los que todos los equipos querrán comunicarse (para poder tener acceso a internet), y mantendrán su ubicación actualizada para poder realizar la comunicación.

Para la mejor visualización de la red con la que se está trabajando, graficamos las comunicaciones en la red en forma de grafos dirigidos, utilizando un script \footnote{\texttt{tgfizar.py}} en Python. Tomamos como nodos los diferentes IP de ésta y como aristas dirigidas la existencia de un paquete ARP con una fuente y un destino específico.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Resultados                                                                %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Resultados}


%% Alto Palermo %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{Red \emph{Alto Palermo}}

\grafo{altopalermo}


\subsubsection{Información de los símbolos de la fuente de información $S_{src}$}

Donde $S_{src} = \{ \text{direcciones IP origen en paquetes ARP \emph{who-has}} \}$.

\input{altopalermo-source}
\vspace{2cm}


\subsubsection{Información de los símbolos de la fuente de información $S_{dst}$}

Donde $S_{dst} = \{ \text{direcciones IP destino en paquetes ARP \emph{who-has}} \}$.

\input{altopalermo-destination}
\vspace{2cm}


%% McDonald's %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{Red \emph{McDonald's}}

\grafo{mcdonalds}

\grafo{mcdonalds-172.17.12.2}

\grafo{mcdonalds-172.17.12.1}

\grafo{mcdonalds-172.17.203.1}

\grafo{mcdonalds-0.0.0.0}


\subsubsection{Información de los símbolos de la fuente de información $S_{src}$}

Donde $S_{src} = \{ \text{direcciones IP origen en paquetes ARP \emph{who-has}} \}$.

\input{mcdonalds-source}
\vspace{2cm}


\subsubsection{Información de los símbolos de la fuente de información $S_{dst}$}

Donde $S_{dst} = \{ \text{direcciones IP destino en paquetes ARP \emph{who-has}} \}$.

\input{mcdonalds-destination}
\vspace{2cm}


%% Starbucks %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{Red \emph{Starbucks}}

\grafo{starbucks}


\subsubsection{Información de los símbolos de la fuente de información $S_{src}$}

Donde $S_{src} = \{ \text{direcciones IP origen en paquetes ARP \emph{who-has}} \}$.

\input{starbucks-source}
\vspace{2cm}


\subsubsection{Información de los símbolos de la fuente de información $S_{dst}$}

Donde $S_{dst} = \{ \text{direcciones IP destino en paquetes ARP \emph{who-has}} \}$.

\input{starbucks-destination}
\vspace{2cm}


%% Entropías calculadas %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{Entropías calculadas}

% Constantes con la entropía calculada
\input{entropia}

\begin{center}
\begin{tabular}{|c|c|c|}
\hline
Red & Fuente de información modelada $S$ & Entropía $H(S)$\\
\hline
Alto Palermo & $S_{src}$ & \altopalermoSrcEntropy\\
Alto Palermo & $S_{dst}$ & \altopalermoDstEntropy\\
\hline
McDonald's   & $S_{src}$ & \mcdonaldsSrcEntropy\\
McDonald's   & $S_{dst}$ & \mcdonaldsDstEntropy\\
\hline
Starbucks    & $S_{src}$ & \starbucksSrcEntropy\\
Starbucks    & $S_{dst}$ & \starbucksDstEntropy\\
\hline
\end{tabular}
\end{center}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Discusión                      			                                 %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Discusión}

\subsection{Fenómenos Destacables}

\subsubsection{Paquetes ARP con IP origen 0.0.0.0}

Podemos detectar en la red de McDonald's y en la de Starbucks paquetes ARP \texttt{who-has} con IP origen 0.0.0.0.
El motivo de uso de esta IP es el siguiente:
Cuando un cliente se conecta a un red que posee un servidor DHCP y quiere recibir una IP de esta, manda una petición con su ID en forma de broadcast para que lo detecte el servidor. Una vez detectado por el servidor, este manda una o varias ofertas de IP a ese ID.
El cliente eventualmente podría recibir la oferta, tomar uno de esos IP y extraer la dirección del router.
Como el servidor realiza la misma operación con todos los demás clientes que pidan una IP, el cliente debe comprobar que la IP que eligió no la tiene otro cliente. Para esto, envía un paquete \texttt{who-has} con su MAC adress y la IP 0.0.0.0 como fuente para evitar confundir las ARP caches en otros hosts. Si el \texttt{who-has} es respuesto, el cliente rechaza el IP elegido.

%Ver como colocar las referencias
%http://www.ietf.org/rfc/rfc2131.txt
%4.4.1


\subsubsection{Paquetes ARP con MAC destino 00:00:00:00:00:00}

Esta MAC es utilizada como dirección de destino para los paquetes llamados de \textit{ARP gratuito}\footnote{\url{http://wiki.wireshark.org/Gratuitous_ARP}}. Este modo de uso del protocolo es mayormente para detectar conflictos de IP en la red o actualizar información en las tablas de los vecinos. La dirección en cuestión se interpreta como broadcast, pero fácilmente distinguible de los paquetes ARP estándar.


\subsubsection{Direcciones en el rango 169.254.0.0/16}


\subsubsection{Misma IP como origen y destino}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Conclusión                                                                %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Conclusión}


\end{document}